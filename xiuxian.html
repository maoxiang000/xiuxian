<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿®ä»™æ¨¡æ‹Ÿå™¨ - ä»å‡¡äººåˆ°é£å‡</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700;900&family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #d4af37;
            --secondary: #8b0000;
            --bg-dark: #0a0a0a;
            --text-gold: #ffd700;
        }
        
        body {
            font-family: 'Noto Serif SC', serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #0f0f1e 100%);
            color: #e0e0e0;
            overflow-x: hidden;
        }
        
        .title-font {
            font-family: 'Ma Shan Zheng', cursive;
        }
        
        .cultivation-bg {
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 119, 198, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 215, 0, 0.1) 0%, transparent 50%);
        }
        
        .card-glass {
            background: rgba(20, 20, 30, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(212, 175, 55, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        .btn-immortal {
            background: linear-gradient(135deg, #2d2d44 0%, #1a1a2e 100%);
            border: 2px solid var(--primary);
            color: var(--text-gold);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-immortal:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
            background: linear-gradient(135deg, #3d3d54 0%, #2a2a3e 100%);
        }
        
        .btn-immortal::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.2), transparent);
            transition: 0.5s;
        }
        
        .btn-immortal:hover::before {
            left: 100%;
        }
        
        .stat-bar {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }
        
        .stat-fill {
            height: 100%;
            background: linear-gradient(90deg, #8b0000, #d4af37);
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }
        
        .realm-badge {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(139, 0, 0, 0.2));
            border: 1px solid var(--primary);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 5px rgba(212, 175, 55, 0.5); }
            50% { box-shadow: 0 0 20px rgba(212, 175, 55, 0.8); }
        }
        
        .floating {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        .event-card {
            border-left: 3px solid var(--primary);
            background: linear-gradient(90deg, rgba(212, 175, 55, 0.1), transparent);
            transition: all 0.3s;
        }
        
        .event-card:hover {
            background: linear-gradient(90deg, rgba(212, 175, 55, 0.2), transparent);
            transform: translateX(5px);
        }
        
        .lightning {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%);
            z-index: 50;
        }
        
        .lightning.active {
            animation: flash 0.5s ease-out;
        }
        
        @keyframes flash {
            0% { opacity: 0; }
            10% { opacity: 1; }
            20% { opacity: 0; }
            30% { opacity: 0.8; }
            100% { opacity: 0; }
        }
        
        .scroll-hide::-webkit-scrollbar {
            width: 6px;
        }
        
        .scroll-hide::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.3);
        }
        
        .scroll-hide::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }
        
        .tribulation-cloud {
            background: radial-gradient(circle at center, #4a4a6a 0%, #1a1a2e 100%);
            animation: storm 3s ease-in-out infinite;
        }
        
        @keyframes storm {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3) drop-shadow(0 0 20px #ff6b6b); }
        }
        
        .hidden { display: none !important; }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .luck-star {
            color: #ffd700;
            text-shadow: 0 0 10px #ffd700;
        }
        
        .dead {
            filter: grayscale(100%) brightness(0.5);
        }
    </style>
</head>
<body class="min-h-screen cultivation-bg">
    <div id="lightning" class="lightning"></div>
    
    <!-- é¡¶éƒ¨æ ‡é¢˜ -->
    <header class="text-center py-6 relative overflow-hidden">
        <div class="absolute inset-0 opacity-20">
            <div class="absolute top-0 left-1/4 w-64 h-64 bg-purple-600 rounded-full filter blur-3xl animate-pulse"></div>
            <div class="absolute bottom-0 right-1/4 w-64 h-64 bg-blue-600 rounded-full filter blur-3xl animate-pulse delay-1000"></div>
        </div>
        <h1 class="title-font text-5xl md:text-7xl text-transparent bg-clip-text bg-gradient-to-r from-yellow-200 via-yellow-400 to-yellow-600 drop-shadow-lg relative z-10 floating">
            ä¿®ä»™æ¨¡æ‹Ÿå™¨
        </h1>
        <p class="text-gray-400 mt-2 text-lg tracking-widest">ä¸€å¿µæˆä»™ Â· ä¸€å¿µæˆé­” Â· ç”Ÿæ­»æœ‰å‘½</p>
    </header>

    <main class="container mx-auto px-4 pb-8 max-w-6xl">
        <!-- æ¸¸æˆä¸»ç•Œé¢ -->
        <div id="game-container" class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <!-- å·¦ä¾§ï¼šçŠ¶æ€é¢æ¿ -->
            <div class="lg:col-span-1 space-y-4">
                <!-- åŸºç¡€ä¿¡æ¯ -->
                <div class="card-glass rounded-2xl p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-yellow-400 title-font" id="player-name">æ— åä¿®å£«</h2>
                        <span id="age-display" class="text-sm text-gray-400">0å²</span>
                    </div>
                    
                    <div id="realm-display" class="realm-badge rounded-lg p-3 text-center mb-4">
                        <div class="text-xs text-gray-400 mb-1">å½“å‰å¢ƒç•Œ</div>
                        <div class="text-xl font-bold text-yellow-300" id="realm-name">å‡¡äºº</div>
                        <div class="text-xs text-gray-500 mt-1" id="realm-desc">å°šæœªè¸å…¥ä»™é€”</div>
                    </div>

                    <!-- çµæ ¹æ˜¾ç¤º -->
                    <div class="mb-4 p-3 bg-black/30 rounded-lg border border-yellow-600/30">
                        <div class="text-xs text-gray-400 mb-2">çµæ ¹èµ„è´¨</div>
                        <div id="spirit-root" class="text-lg font-bold text-cyan-400">æœªæ£€æµ‹</div>
                        <div id="root-quality" class="text-xs text-gray-500 mt-1"></div>
                    </div>

                    <!-- å±æ€§æ¡ -->
                    <div class="space-y-3">
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-gray-400">å¯¿å…ƒ</span>
                                <span class="text-red-400"><span id="lifespan-current">100</span>/<span id="lifespan-max">100</span></span>
                            </div>
                            <div class="stat-bar h-2">
                                <div id="lifespan-bar" class="stat-fill bg-gradient-to-r from-red-600 to-red-400" style="width: 100%"></div>
                            </div>
                        </div>
                        
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-gray-400">ä¿®ä¸º</span>
                                <span class="text-blue-400"><span id="cultivation-current">0</span>/<span id="cultivation-max">100</span></span>
                            </div>
                            <div class="stat-bar h-3">
                                <div id="cultivation-bar" class="stat-fill bg-gradient-to-r from-blue-600 to-cyan-400" style="width: 0%"></div>
                            </div>
                        </div>

                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-gray-400">æ°”è¡€</span>
                                <span class="text-green-400"><span id="health-current">100</span>/<span id="health-max">100</span></span>
                            </div>
                            <div class="stat-bar h-2">
                                <div id="health-bar" class="stat-fill bg-gradient-to-r from-green-600 to-green-400" style="width: 100%"></div>
                            </div>
                        </div>

                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-gray-400">å¿ƒå¢ƒ</span>
                                <span class="text-purple-400"><span id="mental-current">100</span>/100</span>
                            </div>
                            <div class="stat-bar h-2">
                                <div id="mental-bar" class="stat-fill bg-gradient-to-r from-purple-600 to-pink-400" style="width: 100%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- èµ„æºé¢æ¿ -->
                <div class="card-glass rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-yellow-400 mb-3 title-font">å‚¨ç‰©ç©ºé—´</h3>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div class="flex justify-between p-2 bg-black/30 rounded">
                            <span class="text-gray-400">çµçŸ³</span>
                            <span class="text-yellow-400 font-mono" id="resource-stones">0</span>
                        </div>
                        <div class="flex justify-between p-2 bg-black/30 rounded">
                            <span class="text-gray-400">ä¸¹è¯</span>
                            <span class="text-red-400 font-mono" id="resource-pills">0</span>
                        </div>
                        <div class="flex justify-between p-2 bg-black/30 rounded">
                            <span class="text-gray-400">æ³•å®</span>
                            <span class="text-cyan-400 font-mono" id="resource-artifacts">0</span>
                        </div>
                        <div class="flex justify-between p-2 bg-black/30 rounded">
                            <span class="text-gray-400">åŠŸæ³•</span>
                            <span class="text-blue-400 font-mono" id="resource-techniques">0</span>
                        </div>
                    </div>
                </div>

                <!-- ç‰¹æ®ŠçŠ¶æ€ -->
                <div id="status-effects" class="card-glass rounded-2xl p-4 hidden">
                    <h3 class="text-sm font-bold text-gray-400 mb-2">çŠ¶æ€æ•ˆæœ</h3>
                    <div id="status-list" class="flex flex-wrap gap-2"></div>
                </div>
            </div>

            <!-- ä¸­é—´ï¼šä¸»æ“ä½œåŒº -->
            <div class="lg:col-span-2 space-y-4">
                <!-- åœºæ™¯æ˜¾ç¤º -->
                <div class="card-glass rounded-2xl p-8 min-h-[300px] flex flex-col items-center justify-center text-center relative overflow-hidden" id="scene-panel">
                    <div id="scene-bg" class="absolute inset-0 opacity-20 bg-gradient-to-b from-blue-900/20 to-transparent"></div>
                    <div class="relative z-10 w-full">
                        <div id="scene-icon" class="text-6xl mb-4">ğŸ‘¶</div>
                        <h2 id="scene-title" class="text-3xl font-bold text-white mb-4 title-font">å‡ºç”Ÿ</h2>
                        <p id="scene-desc" class="text-gray-300 text-lg leading-relaxed mb-6 max-w-2xl mx-auto">
                            ä½ å‡ºç”Ÿåœ¨ä¸€ä¸ªæ™®é€šçš„å‡¡äººå®¶åº­ã€‚å¤©åœ°çµæ°”æœªå¼€ï¼Œä½ å°šä¸çŸ¥ä¿®ä»™ä¸ºä½•ç‰©ã€‚
                        </p>
                        <div id="scene-actions" class="flex flex-wrap gap-3 justify-center">
                            <button onclick="game.nextYear()" class="btn-immortal px-8 py-3 rounded-lg font-bold text-lg">
                                æˆé•¿ä¸€å²
                            </button>
                        </div>
                    </div>
                </div>

                <!-- æ“ä½œæŒ‰é’®ç»„ -->
                <div id="action-buttons" class="grid grid-cols-2 md:grid-cols-4 gap-3 hidden">
                    <button onclick="game.cultivate()" class="btn-immortal py-4 rounded-xl font-bold flex flex-col items-center gap-1">
                        <span class="text-2xl">ğŸ§˜</span>
                        <span>æ‰“åä¿®ç‚¼</span>
                        <span class="text-xs text-gray-400 font-normal">æå‡ä¿®ä¸º</span>
                    </button>
                    <button onclick="game.explore()" class="btn-immortal py-4 rounded-xl font-bold flex flex-col items-center gap-1">
                        <span class="text-2xl">ğŸ”ï¸</span>
                        <span>å¤–å‡ºå†ç»ƒ</span>
                        <span class="text-xs text-gray-400 font-normal">å¯»æ‰¾æœºç¼˜</span>
                    </button>
                    <button onclick="game.seclusion()" class="btn-immortal py-4 rounded-xl font-bold flex flex-col items-center gap-1">
                        <span class="text-2xl">â›©ï¸</span>
                        <span>é—­å…³çªç ´</span>
                        <span class="text-xs text-gray-400 font-normal">å†²å‡»ç“¶é¢ˆ</span>
                    </button>
                    <button onclick="game.alchemy()" class="btn-immortal py-4 rounded-xl font-bold flex flex-col items-center gap-1">
                        <span class="text-2xl">âš—ï¸</span>
                        <span>ç‚¼ä¸¹ç‚¼å™¨</span>
                        <span class="text-xs text-gray-400 font-normal">è¾…åŠ©ä¿®è¡Œ</span>
                    </button>
                </div>

                <!-- äº‹ä»¶æ—¥å¿— -->
                <div class="card-glass rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-yellow-400 mb-3 title-font flex items-center gap-2">
                        <span>ğŸ“œ</span>
                        <span>ä¿®ä»™æ—¥å¿—</span>
                    </h3>
                    <div id="event-log" class="space-y-2 max-h-64 overflow-y-auto scroll-hide pr-2">
                        <div class="text-gray-500 text-sm italic">ä¿®ä»™ä¹‹è·¯ï¼Œç”±æ­¤å¼€å§‹...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å¼€å§‹ç•Œé¢ -->
        <div id="start-screen" class="fixed inset-0 bg-black/95 z-50 flex items-center justify-center p-4">
            <div class="max-w-md w-full text-center">
                <h1 class="title-font text-6xl text-transparent bg-clip-text bg-gradient-to-r from-yellow-200 to-yellow-600 mb-6">
                    ä¿®ä»™æ¨¡æ‹Ÿå™¨
                </h1>
                <p class="text-gray-400 mb-8 text-lg">ä»å‘±å‘±å åœ°çš„å©´å„¿ï¼Œåˆ°ç¾½åŒ–é£å‡çš„ä»™äºº<br>ä½ çš„ä¸€ç”Ÿï¼Œç”±ä½ ä¹¦å†™</p>
                
                <div class="space-y-4 mb-8">
                    <input type="text" id="input-name" placeholder="è¾“å…¥é“å·ï¼ˆç•™ç©ºéšæœºï¼‰" 
                           class="w-full px-6 py-3 bg-gray-900 border border-yellow-600/50 rounded-lg text-center text-white placeholder-gray-600 focus:outline-none focus:border-yellow-400">
                </div>

                <button onclick="game.start()" class="btn-immortal w-full py-4 rounded-xl font-bold text-xl mb-4">
                    è¸å…¥ä»™é€”
                </button>
                
                <div class="text-xs text-gray-600 mt-4">
                    <p>æç¤ºï¼šçµæ ¹èµ„è´¨å†³å®šä¿®ç‚¼é€Ÿåº¦ï¼Œæœºç¼˜å½±å“å¥‡é‡æ¦‚ç‡</p>
                    <p>å¯¿å…ƒè€—å°½æˆ–é­é‡ä¸æµ‹å°†å¯¼è‡´èº«æ­»é“æ¶ˆ</p>
                </div>
            </div>
        </div>

        <!-- ç»“æŸç•Œé¢ -->
        <div id="end-screen" class="fixed inset-0 bg-black/95 z-50 flex items-center justify-center p-4 hidden">
            <div class="max-w-lg w-full text-center card-glass p-8 rounded-2xl">
                <div id="end-icon" class="text-6xl mb-4">â˜ ï¸</div>
                <h2 id="end-title" class="title-font text-4xl text-white mb-4">èº«æ­»é“æ¶ˆ</h2>
                <p id="end-desc" class="text-gray-300 mb-6 text-lg"></p>
                
                <div class="bg-black/50 rounded-lg p-4 mb-6 text-left space-y-2 text-sm">
                    <div class="flex justify-between"><span class="text-gray-400">äº«å¹´ï¼š</span><span class="text-white" id="end-age"></span></div>
                    <div class="flex justify-between"><span class="text-gray-400">å¢ƒç•Œï¼š</span><span class="text-yellow-400" id="end-realm"></span></div>
                    <div class="flex justify-between"><span class="text-gray-400">çµæ ¹ï¼š</span><span class="text-cyan-400" id="end-root"></span></div>
                    <div class="flex justify-between"><span class="text-gray-400">è¯„ä»·ï¼š</span><span class="text-purple-400" id="end-rank"></span></div>
                </div>

                <button onclick="location.reload()" class="btn-immortal w-full py-3 rounded-xl font-bold">
                    è½¬ä¸–é‡ä¿®
                </button>
            </div>
        </div>

        <!-- çªç ´ç•Œé¢ -->
        <div id="breakthrough-screen" class="fixed inset-0 bg-black/90 z-40 flex items-center justify-center p-4 hidden">
            <div class="max-w-md w-full text-center">
                <div class="tribulation-cloud rounded-full w-48 h-48 mx-auto mb-6 flex items-center justify-center relative">
                    <div class="absolute inset-0 rounded-full animate-ping bg-purple-500/20"></div>
                    <span class="text-6xl">âš¡</span>
                </div>
                <h2 class="title-font text-3xl text-yellow-400 mb-4">å¤©åŠ«é™ä¸´</h2>
                <p class="text-gray-300 mb-6" id="tribulation-desc">é›·äº‘æ»šæ»šï¼Œä¹é‡å¤©åŠ«å³å°†è½ä¸‹...</p>
                <div class="flex gap-4 justify-center">
                    <button onclick="game.resistTribulation()" class="btn-immortal px-8 py-3 rounded-lg font-bold">
                        ç¡¬æŠ—å¤©åŠ«
                    </button>
                    <button onclick="game.useArtifact()" class="btn-immortal px-8 py-3 rounded-lg font-bold border-blue-400 text-blue-400">
                        ç¥­å‡ºæ³•å®
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script>
        // æ¸¸æˆé…ç½®
        const CONFIG = {
            realms: [
                { name: 'å‡¡äºº', max: 0, lifespan: 100, desc: 'å°šæœªè¸å…¥ä»™é€”' },
                { name: 'ç‚¼æ°”æœŸ', max: 100, lifespan: 150, desc: 'å¼•æ°”å…¥ä½“ï¼Œåˆçª¥é—¨å¾„' },
                { name: 'ç­‘åŸºæœŸ', max: 300, lifespan: 200, desc: 'é“åŸºåˆç­‘ï¼Œè„±èƒæ¢éª¨' },
                { name: 'é‡‘ä¸¹æœŸ', max: 600, lifespan: 300, desc: 'é‡‘ä¸¹å¤§é“ï¼Œå¯¿å…ƒå€å¢' },
                { name: 'å…ƒå©´æœŸ', max: 1200, lifespan: 500, desc: 'å…ƒå©´åˆæˆï¼Œç¥è¯†å¤–æ”¾' },
                { name: 'åŒ–ç¥æœŸ', max: 2500, lifespan: 800, desc: 'å…ƒç¥å‡ºçªï¼Œæ„Ÿæ‚Ÿå¤©åœ°' },
                { name: 'ç‚¼è™šæœŸ', max: 5000, lifespan: 1200, desc: 'ç‚¼è™šåˆé“ï¼Œè§¦æ‘¸æ³•åˆ™' },
                { name: 'åˆä½“æœŸ', max: 10000, lifespan: 2000, desc: 'å¤©äººåˆä¸€ï¼Œæ³•åŠ›æ— è¾¹' },
                { name: 'å¤§ä¹˜æœŸ', max: 20000, lifespan: 3000, desc: 'å¤§ä¹˜åœ†æ»¡ï¼ŒåŠæ­¥çœŸä»™' },
                { name: 'æ¸¡åŠ«æœŸ', max: 50000, lifespan: 5000, desc: 'æ¸¡åŠ«é£å‡ï¼Œä¹æ­»ä¸€ç”Ÿ' },
                { name: 'çœŸä»™', max: 999999, lifespan: 99999, desc: 'é£å‡ä»™ç•Œï¼Œä¸å¤©åœ°åŒå¯¿' }
            ],
            roots: [
                { name: 'åºŸçµæ ¹', quality: 0.3, chance: 15, desc: 'ä¿®ç‚¼é€Ÿåº¦ææ…¢ï¼Œå‡ ä¹æ— æ³•çªç ´' },
                { name: 'ä¼ªçµæ ¹', quality: 0.5, chance: 25, desc: 'å››å±æ€§æ··æ‚ï¼Œä¿®ç‚¼è‰°éš¾' },
                { name: 'çœŸçµæ ¹', quality: 0.8, chance: 30, desc: 'ä¸¤ä¸‰ç§å±æ€§ï¼Œä¿®ç‚¼é€Ÿåº¦ä¸€èˆ¬' },
                { name: 'å¤©çµæ ¹', quality: 1.2, chance: 20, desc: 'å•ä¸€å±æ€§ï¼Œä¿®ç‚¼é€Ÿåº¦æå¿«' },
                { name: 'å˜å¼‚çµæ ¹', quality: 1.5, chance: 8, desc: 'ç‰¹æ®Šå˜å¼‚ï¼Œä¿®ç‚¼ç¥é€Ÿ' },
                { name: 'æ··æ²Œçµæ ¹', quality: 2.0, chance: 2, desc: 'äº”è¡Œä¿±å…¨ï¼Œä¸‡æ³•ä¸ä¾µ' }
            ],
            elements: ['é‡‘', 'æœ¨', 'æ°´', 'ç«', 'åœŸ', 'é£', 'é›·', 'å†°'],
            events: {
                child: [
                    { text: 'ä½ å‡ºç”Ÿåœ¨å†œå®¶ï¼Œå®¶å¢ƒè´«å¯’ï¼Œä½†èº«ä½“å¥å£®', effect: () => ({ health: 10 }) },
                    { text: 'ä½ å‡ºç”Ÿåœ¨ä¹¦é¦™é—¨ç¬¬ï¼Œè‡ªå¹¼èªæ…§è¿‡äºº', effect: () => ({ mental: 10 }) },
                    { text: 'ä½ å‡ºç”Ÿåœ¨å•†è´¾ä¹‹å®¶ï¼Œé”¦è¡£ç‰é£Ÿ', effect: () => ({ stones: 100 }) },
                    { text: 'ä½ å‡ºç”Ÿåœ¨å®˜å®¦ä¸–å®¶ï¼Œæ°”è´¨ä¸å‡¡', effect: () => ({ luck: 5 }) },
                    { text: 'ä½ è‡ªå¹¼çˆ¶æ¯åŒäº¡ï¼Œè¢«è€é“å£«æ”¶å…»', effect: () => ({ rootBonus: 0.1 }) }
                ],
                teen: [
                    { text: 'å±±ä¸­å¶é‡çµæœï¼Œè¯¯é£Ÿåä½“è´¨æ”¹å–„', effect: () => ({ health: 20, cultivation: 10 }) },
                    { text: 'æ•‘ä¸‹å—ä¼¤çµå…½ï¼Œè·å¾—çµçŸ³ç­”è°¢', effect: () => ({ stones: 50, luck: 2 }) },
                    { text: 'è·Œè½æ‚¬å´–ï¼Œæ„å¤–å‘ç°å‰è¾ˆæ´åºœ', effect: () => ({ technique: 1, cultivation: 50 }) },
                    { text: 'è¢«è·¯è¿‡çš„ä»™äººå‘ç°çµæ ¹ï¼Œèµ äºˆåŸºç¡€åŠŸæ³•', effect: () => ({ cultivation: 30 }) }
                ],
                adult: [
                    { text: 'åœ¨åŠå¸‚æ·˜åˆ°æ®‹ç ´æ³•å®', effect: () => ({ artifact: 1 }) },
                    { text: 'ç‚¼ä¸¹æ—¶å‘ç”Ÿç‚¸ç‚‰ï¼Œå—ä¼¤ä¸è½»', effect: () => ({ health: -30 }) },
                    { text: 'å¿ƒé­”å…¥ä¾µï¼Œé™©äº›èµ°ç«å…¥é­”', effect: () => ({ mental: -20 }) },
                    { text: 'è§‚æ—¥å‡ºè€Œæ‚Ÿé“ï¼Œä¿®ä¸ºå¤§æ¶¨', effect: () => ({ cultivation: 100, mental: 10 }) }
                ]
            }
        };

        class CultivationGame {
            constructor() {
                this.player = {
                    name: '',
                    age: 0,
                    realm: 0,
                    cultivation: 0,
                    health: 100,
                    maxHealth: 100,
                    mental: 100,
                    lifespan: 100,
                    maxLifespan: 100,
                    root: null,
                    rootElement: '',
                    luck: 50,
                    stones: 0,
                    pills: 0,
                    artifacts: 0,
                    techniques: 0,
                    status: []
                };
                this.history = [];
                this.isDead = false;
                this.inTribulation = false;
            }

            start() {
                const nameInput = document.getElementById('input-name').value.trim();
                this.player.name = nameInput || this.generateName();
                
                // ç”Ÿæˆçµæ ¹
                this.generateSpiritRoot();
                
                // éšè—å¼€å§‹ç•Œé¢
                document.getElementById('start-screen').classList.add('hidden');
                document.getElementById('action-buttons').classList.remove('hidden');
                
                this.updateUI();
                this.log('ä½ çå¼€äº†çœ¼ç›ï¼Œå¼€å§‹äº†ä¿®ä»™ä¹‹è·¯...', 'system');
                this.checkAgeEvents();
            }

            generateName() {
                const surnames = ['æ', 'ç‹', 'å¼ ', 'åˆ˜', 'é™ˆ', 'æ¨', 'èµµ', 'é»„', 'å‘¨', 'å´', 'å¾', 'å­™', 'èƒ¡', 'æœ±', 'é«˜', 'æ—'];
                const names = ['é€é¥', 'é•¿ç”Ÿ', 'æ‚Ÿé“', 'ç„æœº', 'å‡Œéœ„', 'å¾¡é£', 'å¤©è¡Œ', 'è‹¥æ°´', 'æ— å°˜', 'æ˜æœˆ', 'é’æ¾', 'ç´«é˜³'];
                return surnames[Math.floor(Math.random() * surnames.length)] + names[Math.floor(Math.random() * names.length)];
            }

            generateSpiritRoot() {
                const rand = Math.random() * 100;
                let cumulative = 0;
                let selectedRoot = CONFIG.roots[0];
                
                for (let root of CONFIG.roots) {
                    cumulative += root.chance;
                    if (rand <= cumulative) {
                        selectedRoot = root;
                        break;
                    }
                }
                
                this.player.root = selectedRoot;
                this.player.rootElement = CONFIG.elements[Math.floor(Math.random() * 5)]; // äº”è¡Œ
                
                // æ ¹æ®çµæ ¹è°ƒæ•´åŸºç¡€å±æ€§
                if (selectedRoot.name === 'æ··æ²Œçµæ ¹') {
                    this.player.luck += 20;
                    this.player.maxLifespan += 50;
                }
            }

            nextYear() {
                if (this.isDead) return;
                
                this.player.age++;
                
                // å¹´é¾„äº‹ä»¶
                this.checkAgeEvents();
                
                // è‡ªç„¶æ¢å¤
                this.player.health = Math.min(this.player.maxHealth, this.player.health + 5);
                this.player.mental = Math.min(100, this.player.mental + 3);
                
                // å¯¿å…ƒæ£€æŸ¥
                if (this.player.age >= this.player.lifespan) {
                    this.die('å¯¿å…ƒè€—å°½ï¼ŒååŒ–è€Œç»ˆ');
                    return;
                }
                
                // éšæœºäº‹ä»¶
                if (Math.random() < 0.3) {
                    this.randomEvent();
                }
                
                this.updateUI();
            }

            checkAgeEvents() {
                const age = this.player.age;
                
                if (age === 0) {
                    this.setScene('ğŸ‘¶', 'å‡ºç”Ÿ', 'ä½ å‡ºç”Ÿåœ¨ä¸€ä¸ªæ™®é€šçš„å‡¡äººå®¶åº­ã€‚å¤©åœ°çµæ°”æœªå¼€ï¼Œä½ å°šä¸çŸ¥ä¿®ä»™ä¸ºä½•ç‰©ã€‚');
                } else if (age === 6) {
                    this.setScene('ğŸ“š', 'å¯è’™', 'ä½ å¼€å§‹æ¥å—å¯è’™æ•™è‚²ï¼Œå±•ç°å‡ºè¿‡äººçš„èªæ…§ã€‚');
                } else if (age === 12 && this.player.realm === 0) {
                    // çµæ ¹æ£€æµ‹
                    this.setScene('âœ¨', 'çµæ ¹è§‰é†’', `æ£€æµ‹åˆ°${this.player.rootElement}å±æ€§${this.player.root.name}ï¼${this.player.root.desc}`, [
                        { text: 'å¼€å§‹ä¿®ç‚¼', action: () => this.startCultivation() }
                    ]);
                } else if (age === 18 && this.player.realm > 0) {
                    this.setScene('ğŸ—¡ï¸', 'ä¸‹å±±å†ç»ƒ', 'ä½ å·²æˆå¹´ï¼Œå¯ä»¥ä¸‹å±±å†ç»ƒï¼Œå¯»æ‰¾æœºç¼˜ã€‚');
                } else if (age % 10 === 0 && age > 20) {
                    this.setScene('ğŸ‚', `å¤§å¯¿`, `ä½ ä»Šå¹´${age}å²äº†ï¼Œä¿®ä¸ºå·²è¾¾${CONFIG.realms[this.player.realm].name}ã€‚`);
                }
            }

            startCultivation() {
                this.player.realm = 1;
                this.player.cultivation = 0;
                this.player.maxLifespan = CONFIG.realms[1].lifespan;
                this.player.lifespan = this.player.maxLifespan;
                this.log('å¼•æ°”å…¥ä½“æˆåŠŸï¼Œè¸å…¥ç‚¼æ°”æœŸï¼', 'success');
                this.updateUI();
                this.setScene('ğŸ§˜', 'ç‚¼æ°”æœŸ', 'ä½ æˆåŠŸå¼•æ°”å…¥ä½“ï¼Œæ­£å¼è¸å…¥ä¿®ä»™ä¹‹è·¯ã€‚');
            }

            cultivate() {
                if (this.player.realm === 0) {
                    this.log('å°šæœªè§‰é†’çµæ ¹ï¼Œæ— æ³•ä¿®ç‚¼ï¼', 'error');
                    return;
                }

                const baseGain = 10;
                const rootBonus = this.player.root.quality;
                const luckBonus = this.player.luck / 100;
                const gain = Math.floor(baseGain * rootBonus * (1 + luckBonus) * (0.8 + Math.random() * 0.4));
                
                this.player.cultivation += gain;
                this.player.mental -= 2;
                
                // ä¿®ç‚¼æ—¥å¿—
                const msgs = [
                    `è¿è½¬å‘¨å¤©ï¼Œå¸æ”¶çµæ°”ï¼Œä¿®ä¸ºå¢åŠ ${gain}ç‚¹`,
                    'æ„Ÿæ‚Ÿå¤©é“ï¼Œå¿ƒå¢ƒç•¥æœ‰æå‡',
                    'ç»è„‰é€šç•…ï¼Œçµæ°”è¿è¡Œå¦‚æ„'
                ];
                this.log(msgs[Math.floor(Math.random() * msgs.length)], 'info');
                
                // æ£€æŸ¥çªç ´
                this.checkBreakthrough();
                
                // å¿ƒé­”æ£€æŸ¥
                if (this.player.mental < 30 && Math.random() < 0.3) {
                    this.heartDevil();
                }
                
                this.nextYear();
            }

            explore() {
                const events = [
                    { 
                        text: 'åœ¨å±±ä¸­å‘ç°åƒå¹´çµèŠï¼Œç‚¼åŒ–åä¿®ä¸ºå¤§å¢', 
                        effect: () => {
                            this.player.cultivation += 50;
                            this.player.pills += 1;
                            return 'è·å¾—ç­‘åŸºä¸¹ææ–™';
                        }
                    },
                    { 
                        text: 'é­é‡å¦–å…½è¢­å‡»ï¼Œé‡ä¼¤é€ƒå›', 
                        effect: () => {
                            this.player.health -= 40;
                            if (this.player.health <= 0) this.die('è‘¬èº«å…½å£');
                            return 'èº«å—é‡ä¼¤';
                        }
                    },
                    { 
                        text: 'è¯¯å…¥å¤ä¿®æ´åºœï¼Œè·å¾—ä¼ æ‰¿', 
                        effect: () => {
                            this.player.techniques += 1;
                            this.player.cultivation += 100;
                            this.player.stones += 200;
                            return 'è·å¾—åŠŸæ³•ä¸çµçŸ³';
                        }
                    },
                    { 
                        text: 'æ•‘åŠ©å—ä¼¤æ•£ä¿®ï¼Œè·èµ æ³•å®', 
                        effect: () => {
                            this.player.artifacts += 1;
                            this.player.luck += 5;
                            return 'è·å¾—ä¸‹å“æ³•å™¨';
                        }
                    },
                    { 
                        text: 'åœ¨åŠå¸‚æ·˜åˆ°æ®‹ç¼ºç‰ç®€', 
                        effect: () => {
                            this.player.techniques += 0.5;
                            return 'ä¼¼ä¹è®°è½½ç€æŸç§ç§˜æœ¯';
                        }
                    }
                ];
                
                const event = events[Math.floor(Math.random() * events.length)];
                const result = event.effect();
                this.log(`${event.text} - ${result}`, 'event');
                
                this.nextYear();
            }

            seclusion() {
                if (this.player.realm === 0) {
                    this.log('å°šæœªè¸å…¥ä»™é€”ï¼Œæ— æ³•é—­å…³', 'error');
                    return;
                }
                
                const required = CONFIG.realms[this.player.realm].max;
                const progress = this.player.cultivation / required;
                
                if (progress < 0.8) {
                    this.log('ä¿®ä¸ºä¸è¶³ï¼Œé—­å…³çªç ´æˆåŠŸç‡æä½', 'warning');
                    return;
                }
                
                // è¿›å…¥çªç ´ç•Œé¢
                if (this.player.realm >= 3 && Math.random() < 0.5) {
                    this.showTribulation();
                } else {
                    this.attemptBreakthrough();
                }
            }

            showTribulation() {
                this.inTribulation = true;
                document.getElementById('breakthrough-screen').classList.remove('hidden');
                document.getElementById('tribulation-desc').textContent = 
                    `${CONFIG.realms[this.player.realm].name}å¤©åŠ«å³å°†é™ä¸´ï¼Œä¹æ­»ä¸€ç”Ÿï¼`;
            }

            resistTribulation() {
                const success = Math.random() < (0.3 + this.player.health / 200 + this.player.artifacts * 0.1);
                document.getElementById('breakthrough-screen').classList.add('hidden');
                
                if (success) {
                    this.flashLightning();
                    setTimeout(() => this.breakthroughSuccess(), 500);
                } else {
                    this.player.health -= 50;
                    this.log('æ¸¡åŠ«å¤±è´¥ï¼Œèº«å—é‡ä¼¤ï¼Œä¿®ä¸ºè·Œè½', 'error');
                    this.player.cultivation *= 0.5;
                    if (this.player.health <= 0) this.die('æ­»äºå¤©åŠ«ä¹‹ä¸‹');
                }
                this.inTribulation = false;
                this.nextYear();
            }

            useArtifact() {
                if (this.player.artifacts > 0) {
                    this.player.artifacts--;
                    this.log('ç¥­å‡ºæ³•å®æŠµæŒ¡å¤©åŠ«ï¼', 'success');
                    setTimeout(() => {
                        document.getElementById('breakthrough-screen').classList.add('hidden');
                        this.breakthroughSuccess();
                        this.inTribulation = false;
                        this.nextYear();
                    }, 1000);
                } else {
                    this.log('æ²¡æœ‰å¯ç”¨æ³•å®ï¼', 'error');
                }
            }

            attemptBreakthrough() {
                const required = CONFIG.realms[this.player.realm].max;
                const chance = 0.5 + (this.player.cultivation - required * 0.8) / (required * 0.4);
                
                if (Math.random() < chance) {
                    this.breakthroughSuccess();
                } else {
                    this.log('çªç ´å¤±è´¥ï¼Œç“¶é¢ˆç¨³å›ºï¼Œéœ€ç§¯ç´¯æ›´å¤šä¿®ä¸º', 'warning');
                    this.player.mental -= 10;
                }
                this.nextYear();
            }

            breakthroughSuccess() {
                if (this.player.realm >= CONFIG.realms.length - 1) {
                    this.ascend();
                    return;
                }
                
                this.player.realm++;
                const newRealm = CONFIG.realms[this.player.realm];
                this.player.maxLifespan = newRealm.lifespan;
                this.player.lifespan = Math.max(this.player.lifespan, this.player.age + newRealm.lifespan * 0.3);
                this.player.cultivation = 0;
                this.player.maxHealth += 50;
                this.player.health = this.player.maxHealth;
                
                this.log(`çªç ´æˆåŠŸï¼è¸å…¥${newRealm.name}ï¼å¯¿å…ƒå¢åŠ è‡³${newRealm.lifespan}å¹´`, 'success');
                
                if (this.player.realm === 10) {
                    this.ascend();
                }
                
                this.updateUI();
            }

            alchemy() {
                if (this.player.stones < 50) {
                    this.log('çµçŸ³ä¸è¶³ï¼Œæ— æ³•ç‚¼ä¸¹', 'error');
                    return;
                }
                
                this.player.stones -= 50;
                const success = Math.random() < (0.4 + this.player.techniques * 0.1);
                
                if (success) {
                    this.player.pills += 1;
                    this.log('ç‚¼ä¸¹æˆåŠŸï¼è·å¾—ä¸€æšä¸¹è¯', 'success');
                } else {
                    this.log('ç‚¼ä¸¹å¤±è´¥ï¼Œææ–™å°½æ¯', 'error');
                    this.player.mental -= 5;
                }
                
                this.nextYear();
            }

            checkBreakthrough() {
                if (this.player.realm === 0) return;
                const required = CONFIG.realms[this.player.realm].max;
                if (this.player.cultivation >= required) {
                    this.log('ä¿®ä¸ºåœ†æ»¡ï¼Œå¯ä»¥å°è¯•çªç ´ä¸‹ä¸€å¢ƒç•Œï¼', 'warning');
                }
            }

            heartDevil() {
                this.log('å¿ƒé­”å…¥ä¾µï¼é“å¿ƒä¸ç¨³ï¼', 'error');
                const damage = Math.floor(Math.random() * 30) + 10;
                this.player.mental -= damage;
                if (this.player.mental <= 0) {
                    this.die('èµ°ç«å…¥é­”ï¼Œçˆ†ä½“è€Œäº¡');
                }
            }

            randomEvent() {
                const age = this.player.age;
                let pool = [];
                
                if (age < 12) pool = CONFIG.events.child;
                else if (age < 30) pool = CONFIG.events.teen;
                else pool = CONFIG.events.adult;
                
                if (pool.length > 0) {
                    const event = pool[Math.floor(Math.random() * pool.length)];
                    const result = event.effect();
                    
                    // åº”ç”¨æ•ˆæœ
                    if (result.health) this.player.health = Math.min(this.player.maxHealth, this.player.health + result.health);
                    if (result.mental) this.player.mental = Math.min(100, this.player.mental + result.mental);
                    if (result.cultivation) this.player.cultivation += result.cultivation;
                    if (result.stones) this.player.stones += result.stones;
                    if (result.luck) this.player.luck += result.luck;
                    if (result.technique) this.player.techniques += result.technique;
                    if (result.artifact) this.player.artifacts += result.artifact;
                    if (result.rootBonus) this.player.root.quality += result.rootBonus;
                    
                    this.log(event.text, 'event');
                }
            }

            ascend() {
                this.isDead = true;
                document.getElementById('end-screen').classList.remove('hidden');
                document.getElementById('end-icon').textContent = 'â˜ï¸';
                document.getElementById('end-title').textContent = 'é£å‡ä»™ç•Œ';
                document.getElementById('end-title').className = 'title-font text-4xl text-yellow-400 mb-4';
                document.getElementById('end-desc').textContent = 'ä½ æˆåŠŸæ¸¡è¿‡ä¹é‡å¤©åŠ«ï¼Œç¾½åŒ–é£å‡ï¼Œæˆä¸ºçœŸä»™ï¼';
                document.getElementById('end-age').textContent = this.player.age + 'å²';
                document.getElementById('end-realm').textContent = 'çœŸä»™';
                document.getElementById('end-root').textContent = this.player.root.name;
                document.getElementById('end-rank').textContent = 'S+ (å®Œç¾é£å‡)';
            }

            die(reason) {
                this.isDead = true;
                document.getElementById('end-screen').classList.remove('hidden');
                document.getElementById('end-desc').textContent = reason;
                document.getElementById('end-age').textContent = this.player.age + 'å²';
                document.getElementById('end-realm').textContent = CONFIG.realms[this.player.realm].name;
                document.getElementById('end-root').textContent = this.player.root.name;
                
                // è®¡ç®—è¯„ä»·
                let rank = 'D';
                if (this.player.realm >= 9) rank = 'A';
                else if (this.player.realm >= 7) rank = 'B';
                else if (this.player.realm >= 5) rank = 'C';
                if (this.player.age < 100 && this.player.realm > 3) rank += '+';
                
                document.getElementById('end-rank').textContent = rank;
                
                // å˜ç°æ•ˆæœ
                document.getElementById('game-container').classList.add('dead');
            }

            setScene(icon, title, desc, actions = null) {
                document.getElementById('scene-icon').textContent = icon;
                document.getElementById('scene-title').textContent = title;
                document.getElementById('scene-desc').textContent = desc;
                
                const actionsDiv = document.getElementById('scene-actions');
                if (actions) {
                    actionsDiv.innerHTML = actions.map(a => 
                        `<button onclick="${a.action}" class="btn-immortal px-6 py-2 rounded-lg">${a.text}</button>`
                    ).join('');
                } else {
                    actionsDiv.innerHTML = '<button onclick="game.nextYear()" class="btn-immortal px-8 py-3 rounded-lg font-bold text-lg">æˆé•¿ä¸€å²</button>';
                }
            }

            log(msg, type = 'normal') {
                const logDiv = document.getElementById('event-log');
                const entry = document.createElement('div');
                entry.className = 'event-card p-3 rounded text-sm fade-in';
                
                const colors = {
                    normal: 'text-gray-300',
                    success: 'text-green-400',
                    error: 'text-red-400',
                    warning: 'text-yellow-400',
                    info: 'text-blue-400',
                    event: 'text-purple-400',
                    system: 'text-cyan-400 font-bold'
                };
                
                const time = `[${this.player.age}å²] `;
                entry.innerHTML = `<span class="text-gray-500 text-xs">${time}</span><span class="${colors[type] || 'text-gray-300'}">${msg}</span>`;
                
                logDiv.insertBefore(entry, logDiv.firstChild);
                
                // é™åˆ¶æ—¥å¿—æ•°é‡
                while (logDiv.children.length > 50) {
                    logDiv.removeChild(logDiv.lastChild);
                }
            }

            flashLightning() {
                const lightning = document.getElementById('lightning');
                lightning.classList.add('active');
                setTimeout(() => lightning.classList.remove('active'), 500);
            }

            updateUI() {
                // åŸºç¡€ä¿¡æ¯
                document.getElementById('player-name').textContent = this.player.name;
                document.getElementById('age-display').textContent = this.player.age + 'å²';
                
                // å¢ƒç•Œ
                const realm = CONFIG.realms[this.player.realm];
                document.getElementById('realm-name').textContent = realm.name;
                document.getElementById('realm-desc').textContent = realm.desc;
                
                // çµæ ¹
                document.getElementById('spirit-root').textContent = 
                    this.player.realm === 0 ? 'æœªæ£€æµ‹' : `${this.player.rootElement}çµæ ¹`;
                document.getElementById('root-quality').textContent = 
                    this.player.root ? this.player.root.name : '';
                
                // å±æ€§æ¡
                const lifespanPercent = (this.player.lifespan / this.player.maxLifespan) * 100;
                document.getElementById('lifespan-current').textContent = Math.floor(this.player.lifespan);
                document.getElementById('lifespan-max').textContent = this.player.maxLifespan;
                document.getElementById('lifespan-bar').style.width = lifespanPercent + '%';
                
                const cultPercent = this.player.realm === 0 ? 0 : 
                    Math.min(100, (this.player.cultivation / realm.max) * 100);
                document.getElementById('cultivation-current').textContent = Math.floor(this.player.cultivation);
                document.getElementById('cultivation-max').textContent = realm.max;
                document.getElementById('cultivation-bar').style.width = cultPercent + '%';
                
                const healthPercent = (this.player.health / this.player.maxHealth) * 100;
                document.getElementById('health-current').textContent = Math.floor(this.player.health);
                document.getElementById('health-max').textContent = this.player.maxHealth;
                document.getElementById('health-bar').style.width = healthPercent + '%';
                
                document.getElementById('mental-current').textContent = Math.floor(this.player.mental);
                document.getElementById('mental-bar').style.width = this.player.mental + '%';
                
                // èµ„æº
                document.getElementById('resource-stones').textContent = this.player.stones;
                document.getElementById('resource-pills').textContent = this.player.pills;
                document.getElementById('resource-artifacts').textContent = this.player.artifacts;
                document.getElementById('resource-techniques').textContent = this.player.techniques;
            }
        }

        // å¯åŠ¨æ¸¸æˆ
        const game = new CultivationGame();
    </script>
</body>
</html>